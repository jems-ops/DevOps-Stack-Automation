---
- name: Install SSL Certificates for Dynamic Nginx Reverse Proxy
  hosts: nginx
  gather_facts: yes
  become: yes

  pre_tasks:
    - name: Display SSL installation information
      debug:
        msg: |
          Installing SSL certificates for: {{ site_backends | map(attribute='server_name') | join(', ') }}
          Target: {{ inventory_hostname }}
          Certificates: {{ site_backends | length }}

  roles:
    - install-ssl-cert

  post_tasks:
    - name: Display SSL completion message
      debug:
        msg: |
          SSL certificates installed successfully!

          HTTPS URLs:
          {% for backend in site_backends %}
          - https://{{ backend.server_name }}
          {% endfor %}

          Note: Self-signed certificates require browser security exceptions
