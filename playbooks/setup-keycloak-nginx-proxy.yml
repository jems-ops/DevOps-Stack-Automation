---
- name: Setup Nginx Reverse Proxy for Keycloak
  hosts: nginx
  gather_facts: yes
  become: yes

  vars:
    backend_service: keycloak

  pre_tasks:
    - name: Display proxy setup information
      debug:
        msg: |
          ğŸ” Keycloak Nginx Reverse Proxy Setup Playbook
          ğŸ“… Execution time: {{ ansible_date_time.iso8601 }}
          ğŸ–¥ï¸  Nginx server: {{ inventory_hostname }}
          ğŸ”— Keycloak backend: 192.168.201.12:8080
          ğŸ‘¤ User: {{ ansible_user }}

  roles:
    - setup-nginx-reverse-proxy

  post_tasks:
    - name: Display completion message
      debug:
        msg: |
          âœ… Keycloak Nginx Reverse Proxy Setup Complete!

          ğŸ“Š Summary:
          â€¢ Nginx server: {{ inventory_hostname }}
          â€¢ Backend: 192.168.201.12:8080
          â€¢ Configuration: /etc/nginx/conf.d/keycloak.conf

          ğŸŒ Access Information:
          â€¢ Direct Keycloak: http://192.168.201.12:8080
          â€¢ Via Proxy: http://{{ inventory_hostname }}
          â€¢ Domain: http://keycloak.example.com (configure DNS)

          ğŸ”§ Next Steps:
          1. Test proxy: curl -I http://{{ inventory_hostname }}
          2. Configure DNS/hosts for keycloak.example.com
          3. Install SSL certificate (run install-ssl-cert.yml)
          4. Access Keycloak Admin Console: http://keycloak.example.com/admin/
