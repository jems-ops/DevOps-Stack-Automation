---
- name: Setup Nginx Reverse Proxy for Jenkins
  hosts: nginx
  gather_facts: yes
  become: yes

  pre_tasks:
    - name: Display proxy setup information
      debug:
        msg: |
          Setting up nginx reverse proxy
          Target: {{ inventory_hostname }}
          Backends: {{ site_backends | length if site_backends is defined else 'legacy config' }}

  roles:
    - setup-nginx-reverse-proxy

  post_tasks:
    - name: Display completion message
      debug:
        msg: |
          Nginx reverse proxy setup complete!

          {% if site_backends is defined %}
          Access URLs:
          {% for backend in site_backends %}
          - https://{{ backend.server_name }}
          {% endfor %}
          {% else %}
          Legacy configuration deployed
          {% endif %}

          Next: Configure DNS and install SSL certificates
