---
- name: Setup Nginx Reverse Proxy for SonarQube
  hosts: nginx
  gather_facts: yes
  become: yes
  
  vars:
    backend_service: sonarqube
    
  pre_tasks:
    - name: Display proxy setup information
      debug:
        msg: |
          ğŸ” SonarQube Nginx Reverse Proxy Setup Playbook
          ğŸ“… Execution time: {{ ansible_date_time.iso8601 }}
          ğŸ–¥ï¸  Nginx server: {{ inventory_hostname }}
          ğŸ”— SonarQube backend: 192.168.201.1:9000
          ğŸ‘¤ User: {{ ansible_user }}
          
  roles:
    - setup-nginx-reverse-proxy
    
  post_tasks:
    - name: Display completion message
      debug:
        msg: |
          âœ… SonarQube Nginx Reverse Proxy Setup Complete!
          
          ğŸ“Š Summary:
          â€¢ Nginx server: {{ inventory_hostname }}
          â€¢ Backend: 192.168.201.1:9000
          â€¢ Configuration: /etc/nginx/conf.d/sonarqube.conf
          
          ğŸŒ Access Information:
          â€¢ Direct SonarQube: http://192.168.201.1:9000
          â€¢ Via Proxy: http://{{ inventory_hostname }}
          â€¢ Domain: http://sonar.example.com (configure DNS)
          
          ğŸ”§ Next Steps:
          1. Test proxy: curl -I http://{{ inventory_hostname }}
          2. Configure DNS/hosts for sonar.example.com
          3. Install SSL certificate (run install-ssl-cert.yml)