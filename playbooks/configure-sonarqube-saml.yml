---
# Playbook: Configure SonarQube SAML Integration with Keycloak
# This playbook sets up SAML SSO between SonarQube and Keycloak
# using the generic keycloak_saml_integration role

- name: Configure SonarQube SAML Integration with Keycloak
  hosts: sonarqube_servers
  become: yes

  vars:
    # Application Type Configuration
    keycloak_saml_integration_app_type: "sonarqube"

  roles:
    - role: keycloak_saml_integration
      tags:
        - sonarqube
        - saml
        - keycloak

  post_tasks:
    - name: Display SAML login instructions
      ansible.builtin.debug:
        msg:
          - "ğŸ‰ SonarQube SAML Integration Complete!"
          - ""
          - "ğŸ“‹ Test User Credentials:"
          - "   Username: sonarqube-demo"
          - "   Password: SonarqubeDemo123!"
          - "   Groups: sonarqube-users, sonarqube-admins"
          - ""
          - "ğŸ” SAML Login:"
          - "   {{ sonarqube_base_url }}"
          - "   Look for 'Log in with SAML' button on the login page"
          - ""
          - "ğŸ’¡ Note: SonarQube automatically displays a SAML login button when SAML is enabled."
          - ""
          - "ğŸ”§ First-time Setup:"
          - "   1. Login with SAML using the test user"
          - "   2. Grant admin permissions to sonarqube-admins group in SonarQube UI"
          - "   3. Configure group synchronization if needed"
