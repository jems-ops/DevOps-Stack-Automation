# {{ ansible_managed }}
# SAML Configuration for {{ common_saml_app_name | title }}
# Generated by common-saml role

{% if common_saml_debug %}
# Debug mode: ON
{% endif %}

# Base URL Configuration
{% if common_saml_config.base_url is defined and common_saml_config.base_url %}
sonar.core.serverBaseURL={{ common_saml_config.base_url }}
{% endif %}

# Force Authentication
sonar.forceAuthentication={{ common_saml_config.force_authentication | default('false') | lower }}

# SAML Authentication Settings
sonar.auth.saml.enabled={{ common_saml_config.enabled | default('true') | lower }}
sonar.auth.saml.applicationId={{ common_saml_config.application_id | default(common_saml_app_name) }}
sonar.auth.saml.providerName={{ common_saml_config.provider_name | default('Keycloak SAML') }}

{% if common_saml_config.provider_id is defined and common_saml_config.provider_id %}
sonar.auth.saml.providerId={{ common_saml_config.provider_id }}
{% endif %}

{% if common_saml_config.login_url is defined and common_saml_config.login_url %}
sonar.auth.saml.loginUrl={{ common_saml_config.login_url }}
{% endif %}

{% if common_saml_config.logout_url is defined and common_saml_config.logout_url %}
sonar.auth.saml.logoutUrl={{ common_saml_config.logout_url }}
{% endif %}

# Service Provider Configuration
sonar.auth.saml.sp.entityId={{ common_saml_config.sp_entity_id | default(common_saml_app_name) }}

{% if common_saml_config.sp_certificate is defined and common_saml_config.sp_certificate %}
sonar.auth.saml.sp.certificate.secured={{ common_saml_config.sp_certificate }}
{% endif %}

{% if common_saml_config.sp_private_key is defined and common_saml_config.sp_private_key %}
sonar.auth.saml.sp.privateKey.secured={{ common_saml_config.sp_private_key }}
{% endif %}

# User Attribute Mappings
sonar.auth.saml.user.login={{ common_saml_config.user.login | default('username') }}
sonar.auth.saml.user.name={{ common_saml_config.user.name | default('name') }}
sonar.auth.saml.user.email={{ common_saml_config.user.email | default('email') }}

# User Provisioning
sonar.auth.saml.user.signUpEnabled={{ common_saml_config.user.sign_up_enabled | default('true') | lower }}

{% if common_saml_config.user.default_group is defined and common_saml_config.user.default_group %}
sonar.auth.saml.user.defaultGroup={{ common_saml_config.user.default_group }}
{% endif %}

# Group Mappings
{% if common_saml_config.group is defined and common_saml_config.group.name is defined and common_saml_config.group.name %}
sonar.auth.saml.group.name={{ common_saml_config.group.name }}
{% endif %}

# Signature Configuration
{% if common_saml_config.signature is defined %}
{% if common_saml_config.signature.enabled is defined %}
sonar.auth.saml.signature.enabled={{ common_saml_config.signature.enabled | lower }}
{% endif %}
{% if common_saml_config.signature.certificate is defined and common_saml_config.signature.certificate %}
sonar.auth.saml.signature.certificate.secured={{ common_saml_config.signature.certificate }}
{% endif %}
{% endif %}
