# SonarQube SAML Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Keycloak SAML Integration for {{ keycloak_saml_integration_app_name | capitalize }}

#----- SAML Authentication Configuration
# Enable SAML authentication
sonar.auth.saml.enabled=true

# SAML Application ID (matches the Keycloak client ID)
sonar.auth.saml.applicationId={{ keycloak_saml_integration_client.client_id }}

# Identity Provider Name
sonar.auth.saml.providerName=Keycloak SAML

# Identity Provider ID (Keycloak realm URL)
sonar.auth.saml.providerId={{ keycloak_saml_integration_keycloak.base_url }}/realms/{{ keycloak_saml_integration_keycloak.realm }}

# Identity Provider Login URL
sonar.auth.saml.loginUrl={{ keycloak_saml_integration_keycloak.base_url }}/realms/{{ keycloak_saml_integration_keycloak.realm }}/protocol/saml

# Identity Provider Certificate
sonar.auth.saml.certificate.secured={{ keycloak_saml_integration_keycloak_certificate }}

# Service Provider Private Key (optional - leave empty if not signing requests)
sonar.auth.saml.sp.privateKey.secured=

# Service Provider Certificate (optional - leave empty if not signing requests)
sonar.auth.saml.sp.certificate.secured=

#----- SAML User Attributes Mapping
# Map SAML attributes to SonarQube user properties
sonar.auth.saml.user.login={{ keycloak_saml_integration_app_saml.username_attribute }}
sonar.auth.saml.user.name={{ keycloak_saml_integration_app_saml.full_name_attribute }}
sonar.auth.saml.user.email={{ keycloak_saml_integration_app_saml.email_attribute }}
sonar.auth.saml.user.signUpEnabled=true
sonar.auth.saml.user.defaultGroup=sonarqube-users

# Service Provider Entity ID
sonar.auth.saml.sp.entityId={{ keycloak_saml_integration_client.client_id }}

#----- SAML Group Synchronization
# Map SAML group attribute to SonarQube groups
sonar.auth.saml.group.name={{ keycloak_saml_integration_app_saml.groups_attribute }}

#----- SAML Security Settings
# Sign authentication requests (optional)
sonar.auth.saml.signature.enabled=false

# Force authentication for all requests
sonar.forceAuthentication=false

#----- SAML Session Configuration
# Session timeout (optional)
# sonar.web.sessionTimeoutInMinutes=480
