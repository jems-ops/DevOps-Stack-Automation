---
# Reusable task: Restart service with wait
# Parameters:
#   - service_name: Name of the systemd service
#   - service_port: Port number to check
#   - service_timeout: Timeout for service start (default: 300)

- name: Stop service
  ansible.builtin.systemd:
    name: "{{ service_name }}"
    state: stopped
  become: true

- name: Wait for service to stop
  ansible.builtin.wait_for:
    port: "{{ service_port }}"
    host: 127.0.0.1
    state: stopped
    timeout: 60

- name: Start service
  ansible.builtin.systemd:
    name: "{{ service_name }}"
    state: started
    enabled: true
  become: true

- name: Wait for service to start
  ansible.builtin.wait_for:
    port: "{{ service_port }}"
    host: 127.0.0.1
    state: started
    timeout: "{{ service_timeout | default(300) }}"
