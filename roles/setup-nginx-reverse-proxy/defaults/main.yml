---
# Default variables for nginx reverse proxy setup - Dynamic Backend Support

# Nginx configuration paths
nginx_config_path: /etc/nginx/conf.d
nginx_listen_port: 80
nginx_https_port: 443

# SSL configuration
ssl_cert_dir: /etc/nginx/tls
ssl_cert_file: "{{ ssl_cert_dir }}/site.crt"
ssl_key_file: "{{ ssl_cert_dir }}/site.key"
ssl_dhparam_file: "{{ ssl_cert_dir }}/dhparam.pem"

# Logging
nginx_access_log: /var/log/nginx/access.log
nginx_error_log: /var/log/nginx/error.log

# Connection settings
nginx_keepalive_connections: 32
nginx_client_max_body_size: 10m
nginx_client_body_buffer_size: 128k
nginx_proxy_connect_timeout: 90
nginx_proxy_send_timeout: 90
nginx_proxy_read_timeout: 90

# Service configuration
nginx_service_enabled: yes
nginx_service_state: started

# Jenkins-specific configuration
jenkins_home: /var/lib/jenkins
jenkins_war_root: /var/run/jenkins/war

# Rewrite rules configuration
# Global rewrite rule applied to all backends (optional)
# site_rewrite_rule: "^/old-path/(.*) /new-path/$1 permanent"

# Per-backend rewrite rules (optional)
# Can be defined in site_backends with 'rewrite_rule' key

# Default site_backends (will be overridden by group_vars/all.yml)
site_backends:
  - server_name: "jenkins.example.com"
    ip: "192.168.201.14"
    port: "8080"
    # Optional per-backend rewrite rule:
    # rewrite_rule: "^/jenkins/(.*) /$1 break"
  - server_name: "sonar.example.com"
    ip: "192.168.201.16"
    port: "9000"
    # Optional per-backend rewrite rule:
    # rewrite_rule: "^/sonar/(.*) /$1 break"
  - server_name: "keycloak.example.com"
    ip: "192.168.201.12"
    port: "8080"
    # Optional per-backend rewrite rule:
    # rewrite_rule: "^/keycloak/(.*) /$1 break"

setup_nginx_reverse_proxy_sites:
  - name: jenkins
    server_name:
      - jenkins.local.com
    backend_host: "192.168.201.14"
    backend_port: "8080"

  - name: sonar
    server_name:
      - sonar.local.com
    backend_host: "192.168.201.16"
    backend_port: "9000"

  - name: nginx
    server_name:
      - sonar.local.com
    backend_host: "192.168.201.16"
    backend_port: "9000"

  - name: keycloak
    server_name:
      - keycloak.local.com
    backend_host: "192.168.201.12"
    backend_port: "8080"
