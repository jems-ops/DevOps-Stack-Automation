---
# SonarQube-Keycloak SAML Integration Handlers

- name: restart_sonarqube
  ansible.builtin.systemd:
    name: "{{ sonarqube.service_name }}"
    state: restarted
    enabled: true
  become: true
  listen: restart_sonarqube

- name: wait_for_sonarqube
  ansible.builtin.uri:
    url: "{{ sonarqube.base_url }}/api/system/status"
    method: GET
    status_code: [200]
    return_content: true
  register: sonarqube_status_check
  until: "sonarqube_status_check.json is defined and sonarqube_status_check.json.status == 'UP'"
  retries: 30
  delay: 10
  failed_when: false
  listen: wait_for_sonarqube
